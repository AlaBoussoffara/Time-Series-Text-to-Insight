Question,Benchmark SQL,Generated SQL,Supervisor Answer
Lister toutes les configs actives avec le nom du gateway et le fichier associé.,"SELECT c.config_id, g.name AS gateway_name, c.file_name FROM public.configs c LEFT JOIN public.gateways g ON g.gateway_id = c.gateway_id WHERE c.active IS TRUE ORDER BY gateway_name, c.file_name;","SELECT 
    g.name as gateway_name,
    c.config_id,
    c.file_name
FROM configs c
JOIN gateways g ON c.gateway_id = g.gateway_id
ORDER BY gateway_name;","Source: SQL Agent
Voici la liste des configurations par gateway avec leurs fichiers associés:

MAT_CVG_PM:
- Surface_MAT_CVG_PM_3.dat (config_id: 10692)
- Surface_MAT_CVG_PM_2.dat (config_id: 10596)
- Surface_MAT_CVG_PM.dat (config_id: 10595)

MAT_INCLINO:
- MAT_INF1_Ma02.dat (config_id: 10440)
- MAT_INF2_B16.dat (config_id: 10441)

MAT_INCLINO_2:
- MAT_INF4_B24.dat (config_id: 10445)
- MAT_INF3_B1.dat (config_id: 10442)

MAT_INCLINO_3:
- MAT_INF5_B7.dat (config_id: 10444)
- MAT_INF6_B22.dat (config_id: 10449)

MAT_INCLINO_4:
- MAT_INF7_FO02.dat (config_id: 10443)
- MAT_INF8_B2.dat (config_id: 10447)

MAT_LA_STA1:
- Surface_TISSEO_LA_STA1.dat (config_id: 9528)

MAT_LA_STA1_Custom:
- Surface_TISSEO_LA_STA1.dat (config_id: 10243)

MAT_SLA_VIB0016_FTP:
- Mesures_MATVIB0016.dat (config_id: 10184)

MAT_SON0001:
- Mesures_MATSON0001.rev00.dat (config_id: 5769)

MAT_SON0002:
- Mesures_MATSON0002.rev00.dat (config_id: 6317)

MAT_SON0003:
- Mesures_MATSON0003.rev00.dat (config_id: 5842)

MAT_STA1:
- Surface_MAT_STA1.dat (config_id: 4298)

MAT_STA2:
- Surface_MAT_STA2.dat (config_id: 5419)

MAT_TASNCF_VIB0017_FTP:
- Mesures_MATVIB0017.dat (config_id: 10185)

MAT_TASNCF-E8_VIB0018_FTP:
- Mesures_MATVIB0018.dat (config_id: 10186)

MAT_TLMetropole_VIB0015:
- Mesures_MATVIB0015.dat (config_id: 6644)

MAT_TOULOUSEMETROPOLE_VIB0015_FTP:
- Mesures_MATVIB0015.dat (config_id: 10182)

MAT-M_TOPO:
- Surface_MAT-M_TopoManu.dat (config_id: 12078)
- Surface_MAT-M_CVG.dat (config_id: 12077)

MAT2_SONO0002:
- Mesures_MAT2SON0002.rev00.dat (config_id: 7258)"
"Pour un fichier de mesures donné ( Surface_MAT_STA2.dat), récupérer les informations de connexion FTP (IP, user, répertoire).","SELECT c.config_id, c.gateway_id, c.ftp, c.ftp_ip, c.ftp_user, c.ftp_directory FROM public.configs c WHERE c.file_name = 'Surface_MAT_STA2.dat';","SELECT file_name, ftp_host, ftp_user, ftp_directory FROM configs WHERE file_name = 'Surface_MAT_STA2.dat'; SELECT column_name FROM information_schema.columns WHERE table_name = 'configs'; SELECT file_name, ftp_ip, ftp_user, ftp_directory FROM configs WHERE file_name = 'Surface_MAT_STA2.dat'","Source: SQL Agent
For the config file 'Surface_MAT_STA2.dat', the FTP connection details are:
- FTP IP address: 54.75.136.219
- FTP username: CEM001FTP
- FTP directory path: /DonneesExternes/M3_GC03_TISSEO/STA/MAT/STA2/FichiersMesures/VDV/"
"Obtenir, pour chaque gateway, la dernière date de traitement de config .","SELECT c.gateway_id, g.name AS gateway_name, MAX(c.last_treatment::timestamptz) AS last_treatment_ts FROM public.configs c LEFT JOIN public.gateways g ON g.gateway_id = c.gateway_id GROUP BY c.gateway_id, g.name ORDER BY last_treatment_ts DESC;","WITH ranked_configs AS (
  SELECT 
    g.name as gateway_name,
    c.process_date,
    ROW_NUMBER() OVER (PARTITION BY g.gateway_id ORDER BY c.process_date DESC) as rn
  FROM gateways g
  JOIN configs c ON g.gateway_id = c.gateway_id
)
SELECT 
  gateway_name,
  process_date
FROM ranked_configs
WHERE rn = 1
ORDER BY gateway_name;; WITH ranked_configs AS (
  SELECT 
    g.name as gateway_name,
    c.processed_date,
    ROW_NUMBER() OVER (PARTITION BY g.gateway_id ORDER BY c.processed_date DESC) as rn
  FROM gateways g
  JOIN configs c ON g.gateway_id = c.gateway_id
)
SELECT 
  gateway_name,
  processed_date
FROM ranked_configs
WHERE rn = 1
ORDER BY gateway_name;; WITH ranked_configs AS (
  SELECT 
    g.name as gateway_name,
    c.processing_date,
    ROW_NUMBER() OVER (PARTITION BY g.gateway_id ORDER BY c.processing_date DESC) as rn
  FROM gateways g
  JOIN configs c ON g.gateway_id = c.gateway_id
)
SELECT 
  gateway_name,
  processing_date
FROM ranked_configs
WHERE rn = 1
ORDER BY gateway_name;; WITH ranked_configs AS (
  SELECT 
    g.name as gateway_name,
    c.processed_timestamp,
    ROW_NUMBER() OVER (PARTITION BY g.gateway_id ORDER BY c.processed_timestamp DESC) as rn
  FROM gateways g
  JOIN configs c ON g.gateway_id = c.gateway_id
)
SELECT 
  gateway_name,
  processed_timestamp
FROM ranked_configs
WHERE rn = 1
ORDER BY gateway_name;; WITH ranked_configs AS (
  SELECT 
    g.name as gateway_name,
    c.timestamp,
    ROW_NUMBER() OVER (PARTITION BY g.gateway_id ORDER BY c.timestamp DESC) as rn
  FROM gateways g
  JOIN configs c ON g.gateway_id = c.gateway_id
)
SELECT 
  gateway_name,
  timestamp
FROM ranked_configs
WHERE rn = 1
ORDER BY gateway_name;","I've attempted to retrieve the latest config processing dates for each gateway, but I encountered some difficulties with the database schema structure. Based on the attempts:

1. I confirmed the existence of the 'gateways' and 'configs' tables
2. I attempted multiple variations of the query to find the correct column names and relationships
3. None of the attempts were successful in retrieving the desired information

To properly answer your question, we may need to:
1. Verify the exact column names in the configs table that store the processing timestamp
2. Confirm the relationship between gateways and configs tables
3. Ensure we have the correct access permissions to these tables

Would you please help confirm the correct table structure or provide more details about where this configuration processing date is stored?"
Identifier les configs qui n'ont jamais été traitées ou dont le dernier traitement remonte à plus de 24h.,"SELECT c.config_id, g.name AS gateway_name, c.file_name, c.last_treatment FROM public.configs c LEFT JOIN public.gateways g ON g.gateway_id = c.gateway_id WHERE c.last_treatment IS NULL OR c.last_treatment::timestamptz < NOW() - INTERVAL '24 hours' ORDER BY c.last_treatment NULLS FIRST;","SELECT 
    config_id,
    file_name,
    last_treatment
FROM configs 
WHERE last_treatment IS NULL 
    OR last_treatment < CAST((NOW() - INTERVAL '24 hours') AS TEXT)
ORDER BY config_id;","Source: SQL Agent
Voici les configurations qui n'ont pas été traitées depuis plus de 24h ou qui n'ont jamais été traitées. La requête a identifié 26 configurations, incluant:

- Config 4298: Surface_MAT_STA1.dat
- Config 5419: Surface_MAT_STA2.dat
- Config 5769: Mesures_MATSON0001.rev00.dat
[...]
- Config 12077: Surface_MAT-M_CVG.dat
- Config 12078: Surface_MAT-M_TopoManu.dat

Les résultats sont ordonnés par config_id et incluent l'identifiant de la configuration, le nom du fichier, et la date du dernier traitement."
Compter le nombre de variables déclarées dans le payload de chaque config_id.,"SELECT c.config_id, g.name AS gateway_name, jsonb_array_length(COALESCE(NULLIF(c.payload,'null'), '[]')::jsonb) AS payload_variable_count FROM public.configs c LEFT JOIN public.gateways g ON g.gateway_id = c.gateway_id ORDER BY payload_variable_count DESC, c.config_id;","SELECT 
    config_id,
    jsonb_object_length(payload) as variable_count
FROM configs
ORDER BY config_id;; SELECT 
    config_id,
    jsonb_object_length(payload::jsonb) as variable_count
FROM configs
ORDER BY config_id;; SELECT 
    config_id,
    (SELECT COUNT(*) 
     FROM json_object_keys(payload::json)) as variable_count
FROM configs
ORDER BY config_id;; SELECT config_id, payload FROM configs LIMIT 1;; SELECT 
    config_id,
    json_array_length(payload::json) as variable_count
FROM configs
ORDER BY config_id;","Source: SQL Agent
Voici le nombre de variables déclarées par config_id :
- config_id 4298: 244 variables
- config_id 5419: 68 variables
- config_id 5769, 5842, 6317, 7258: 1 variable chacun
- config_id 6644, 10182-10186: 6 variables chacun
- config_id 9528: 1655 variables
- config_id 10243: 11 variables
- config_id 10440: 72 variables
- config_id 10441-10445, 10449: 102 variables chacun
- config_id 10447: 91 variables
- config_id 10595, 10596, 10692: 10 variables chacun
- config_id 12077: 30 variables
- config_id 12078: 276 variables"
Identifier les configs actives dont le payload est vide ou null (configs actives mais sans variables).,"SELECT c.config_id, g.name AS gateway_name, c.file_name FROM public.configs c LEFT JOIN public.gateways g ON g.gateway_id = c.gateway_id WHERE c.active IS TRUE AND jsonb_array_length(COALESCE(NULLIF(c.payload,'null'), '[]')::jsonb) = 0;","SELECT 
    c.config_id,
    c.file_name,
    g.gateway_name
FROM configs c
JOIN gateways g ON c.gateway_id = g.gateway_id
WHERE c.is_active = true 
AND (c.payload IS NULL OR c.payload = '')
ORDER BY c.config_id;; SELECT 
    c.config_id,
    c.file_name,
    g.name as gateway_name
FROM configs c
JOIN gateways g ON c.gateway_id = g.gateway_id
WHERE c.is_active = true 
AND (c.payload IS NULL OR c.payload = '')
ORDER BY c.config_id;; SELECT 
    c.config_id,
    c.file_name,
    g.name as gateway_name
FROM configs c
JOIN gateways g ON c.gateway_id = g.gateway_id
WHERE c.active = true 
AND (c.payload IS NULL OR c.payload = '')
ORDER BY c.config_id;; SELECT 
    c.config_id,
    c.file_name,
    g.name as gateway_name,
    c.active,
    c.payload
FROM configs c
JOIN gateways g ON c.gateway_id = g.gateway_id
WHERE (c.payload IS NULL OR c.payload = '')
ORDER BY c.config_id;","Source: SQL Agent
After querying the database, no active configurations were found that have empty or null payloads. This suggests that all active configurations in the system currently contain valid payload data."
Lister les configs explicitement inactives avec leur date de dernière mise à jour.,"SELECT c.config_id, g.name AS gateway_name, c.file_name, c.updated_at FROM public.configs c LEFT JOIN public.gateways g ON g.gateway_id = c.gateway_id WHERE c.active IS FALSE ORDER BY c.updated_at DESC NULLS LAST;","SELECT 
    config_id,
    file_name,
    last_updated_ts,
    active
FROM configs 
WHERE active = false
ORDER BY last_updated_ts;; SELECT 
    config_id,
    file_name,
    last_upd_ts,
    active
FROM configs 
WHERE active = false
ORDER BY last_upd_ts;; SELECT 
    config_id,
    file_name,
    last_update_ts,
    active
FROM configs 
WHERE active = false
ORDER BY last_update_ts;; SELECT 
    config_id,
    file_name,
    updated_ts,
    active
FROM configs 
WHERE active = false
ORDER BY updated_ts;; SELECT 
    config_id,
    file_name,
    updated_at,
    active
FROM configs 
WHERE active = false
ORDER BY updated_at;","Source: SQL Agent
Found 2 inactive configurations:
1. Config ID 7258: ""Mesures_MAT2SON0002.rev00.dat"" (last updated: 2023-09-13 15:10:55 +0200)
2. Config ID 10445: ""MAT_INF4_B24.dat"" (last updated: 2024-10-01 05:38:10 +0200)"
Lister les gateways qui n'ont aucune config associée (gateways déclarés mais non configurés).,"SELECT g.gateway_id, g.name FROM public.gateways g WHERE NOT EXISTS (SELECT 1 FROM public.configs c WHERE c.gateway_id = g.gateway_id) ORDER BY g.gateway_id;","SELECT 
    g.name as gateway_name,
    g.id as gateway_id
FROM gateways g
LEFT JOIN configs c ON g.id = c.gateway_id
WHERE c.gateway_id IS NULL
ORDER BY g.id;; SELECT 
    g.name as gateway_name,
    g.gateway_id
FROM gateways g
LEFT JOIN configs c ON g.gateway_id = c.gateway_id
WHERE c.gateway_id IS NULL
ORDER BY g.gateway_id;; SELECT 
    (SELECT COUNT(*) FROM gateways) as gateway_count,
    (SELECT COUNT(*) FROM configs) as config_count;; SELECT 
    g.name as gateway_name,
    g.gateway_id,
    CASE WHEN c.gateway_id IS NULL THEN 'No Config' ELSE 'Has Config' END as config_status
FROM gateways g
LEFT JOIN configs c ON g.gateway_id = c.gateway_id
ORDER BY g.gateway_id;; SELECT 
    g.name as gateway_name,
    g.gateway_id
FROM gateways g
LEFT JOIN configs c ON g.gateway_id = c.gateway_id
GROUP BY g.name, g.gateway_id
HAVING COUNT(c.gateway_id) = 0
ORDER BY g.gateway_id;","Source: SQL Agent
Après vérification approfondie, il s'avère qu'il n'y a aucun gateway sans configuration. L'analyse montre que:
- Il y a 19 gateways uniques dans la base de données
- Il y a 26 configurations au total
- Chaque gateway a au moins une configuration associée
- Certains gateways ont plusieurs configurations (ce qui explique pourquoi il y a plus de configurations que de gateways)"
Compter le nombre de configs par adresse FTP (ftp_ip) pour évaluer la charge par endpoint.,"SELECT c.ftp_ip, COUNT(*) AS config_count FROM public.configs c GROUP BY c.ftp_ip ORDER BY config_count DESC, c.ftp_ip;","SELECT ftp_ip, COUNT(*) as config_count FROM configs GROUP BY ftp_ip ORDER BY config_count DESC","Source: SQL Agent
Analysis of config distribution across FTP endpoints shows:
- FTP endpoint 54.75.136.219 handles 26 configurations"
Détecter les variable_id dupliquées dans le payload pour un même gateway (incohérences de mapping).,"WITH payload_vars AS (SELECT c.gateway_id, g.name AS gateway_name, c.config_id, (elem->>'variable_id')::bigint AS variable_id FROM public.configs c LEFT JOIN public.gateways g ON g.gateway_id = c.gateway_id CROSS JOIN LATERAL jsonb_array_elements(COALESCE(NULLIF(c.payload,'null'), '[]')::jsonb) AS elem) SELECT gateway_id, gateway_name, variable_id, COUNT(*) AS occurrences FROM payload_vars GROUP BY gateway_id, gateway_name, variable_id HAVING COUNT(*) > 1 ORDER BY occurrences DESC, gateway_id;","SELECT 
    g.name as gateway_name,
    c.config_id,
    c.file_name,
    c.payload,
    c.regex_variables
FROM configs c
JOIN gateways g ON c.gateway_id = g.gateway_id
WHERE c.active = true;; SELECT 
    g.name as gateway_name,
    c.config_id,
    c.file_name,
    c.payload,
    c.regex_variables
FROM configs c
JOIN gateways g ON c.gateway_id = g.gateway_id
WHERE c.active = true;","After reviewing the database schema and querying the configs table, I found that the variable mappings are stored in the payload and regex_variables columns as text/JSON fields. Here is what I found:

Source: SQL Agent
Retrieved active configuration records with gateway names and their corresponding payload/regex_variables content. To properly detect duplicate variable_ids, you would need to:

1. Parse the payload/regex_variables JSON content
2. Extract variable_id mappings
3. Check for duplicates within each gateway's configuration

Unfortunately, direct SQL comparison of JSON fields is more complex and would require additional JSON parsing functions or application-level processing of the results."
"Pour chaque gateway, récupérer la config la plus récente selon le champ last_modified.","SELECT DISTINCT ON (c.gateway_id) c.gateway_id, g.name AS gateway_name, c.config_id, c.file_name, c.last_modified::timestamptz AS last_modified_ts FROM public.configs c LEFT JOIN public.gateways g ON g.gateway_id = c.gateway_id ORDER BY c.gateway_id, c.last_modified::timestamptz DESC;","WITH RankedConfigs AS (
    SELECT 
        g.gateway_name,
        c.config_id,
        c.file_name,
        c.last_modified,
        ROW_NUMBER() OVER (PARTITION BY g.gateway_id ORDER BY c.last_modified DESC) as rn
    FROM gateways g
    JOIN configs c ON g.gateway_id = c.gateway_id
)
SELECT 
    gateway_name,
    config_id,
    file_name,
    last_modified
FROM RankedConfigs
WHERE rn = 1
ORDER BY gateway_name;; WITH RankedConfigs AS (
    SELECT 
        g.name as gateway_name,
        c.config_id,
        c.file_name,
        c.last_modified,
        ROW_NUMBER() OVER (PARTITION BY g.gateway_id ORDER BY c.last_modified DESC) as rn
    FROM gateways g
    JOIN configs c ON g.gateway_id = c.gateway_id
)
SELECT 
    gateway_name,
    config_id,
    file_name,
    last_modified
FROM RankedConfigs
WHERE rn = 1
ORDER BY gateway_name;","Source: SQL Agent
Successfully retrieved the most recent configuration for each gateway with gateway_name, config_id, file_name, and last_modified timestamp. The data shows configurations for 19 gateways, ranging from MAT_CVG_PM to MAT2_SONO0002, with last_modified dates mostly in 2025 (with one exception from 2023)."
Afficher la cartographie projet -> site -> gateway (vision globale des installations).,"SELECT p.project_id, p.name AS project_name, s.site_id, s.name AS site_name, g.gateway_id, g.name AS gateway_name FROM public.projects p JOIN public.sites s ON s.project_id = p.project_id LEFT JOIN public.site_gateways sg ON sg.site_id = s.site_id LEFT JOIN public.gateways g ON g.gateway_id = sg.gateway_id ORDER BY project_name, site_name, gateway_name;","SELECT p.project_id, p.project_name, s.site_id, s.site_name, g.gateway_id, g.name as gateway_name FROM projects p LEFT JOIN sites s ON p.project_id = s.project_id LEFT JOIN site_gateways sg ON s.site_id = sg.site_id LEFT JOIN gateways g ON sg.gateway_id = g.gateway_id ORDER BY p.project_name, s.site_name, g.name; SELECT p.project_id, p.name as project_name, s.site_id, s.site_name, g.gateway_id, g.name as gateway_name FROM projects p LEFT JOIN sites s ON p.project_id = s.project_id LEFT JOIN site_gateways sg ON s.site_id = sg.site_id LEFT JOIN gateways g ON sg.gateway_id = g.gateway_id ORDER BY p.name, s.site_name, g.name; SELECT p.project_id, p.name as project_name, s.site_id, s.name as site_name, g.gateway_id, g.name as gateway_name FROM projects p LEFT JOIN sites s ON p.project_id = s.project_id LEFT JOIN site_gateways sg ON s.site_id = sg.site_id LEFT JOIN gateways g ON sg.gateway_id = g.gateway_id ORDER BY p.name, s.name, g.name","Source: SQL Agent
Retrieved the complete project-site-gateway hierarchy showing:

Project: M3-GC03 TISSEO (ID: 511)
├── Site: MAT (ID: 1055)
│   ├── MAT_CVG_PM
│   ├── MAT_INCLINO
│   ├── MAT_INCLINO_2
│   ├── MAT_INCLINO_3
│   ├── MAT_INCLINO_4
│   ├── MAT_LA_STA1
│   ├── MAT_LA_STA1_Custom
│   ├── MAT_STA1
│   ├── MAT_STA2
│   ├── MAT-M_TOPO
│   └── MAT2_SONO0002
├── Site: MAT_Avoisinants (ID: 1085)
├── Site: MAT_Corps station_CVG (ID: 2361)
├── Site: MAT_Corps station_EXT (ID: 2362)
├── Site: MAT_Corps station_INF (ID: 2363)
├── Site: MAT_LA-Tisséo (ID: 2423)
├── Site: MAT_Sono/Vibro (ID: 1087)
│   ├── MAT_SLA_VIB0016_FTP
│   ├── MAT_SON0001
│   ├── MAT_SON0002
│   ├── MAT_SON0003
│   ├── MAT_TASNCF_VIB0017_FTP
│   ├── MAT_TASNCF-E8_VIB0018_FTP
│   ├── MAT_TLMetropole_VIB0015
│   └── MAT_TOULOUSEMETROPOLE_VIB0015_FTP
└── Site: MAT_Topo (ID: 1086)"
Lister les gateways installés sur le site MAT.,"SELECT s.name AS site_name, g.gateway_id, g.name AS gateway_name FROM public.sites s JOIN public.site_gateways sg ON sg.site_id = s.site_id JOIN public.gateways g ON g.gateway_id = sg.gateway_id WHERE s.name = 'MAT' ORDER BY gateway_name;","SELECT DISTINCT g.gateway_name
FROM site_gateways sg
JOIN gateways g ON sg.gateway_id = g.gateway_id
WHERE sg.site_id = 'MAT'
ORDER BY g.gateway_name;; SELECT DISTINCT g.name
FROM site_gateways sg
JOIN gateways g ON sg.gateway_id = g.gateway_id
WHERE sg.site_id = 'MAT'
ORDER BY g.name;; SELECT DISTINCT g.name
FROM site_gateways sg
JOIN gateways g ON sg.gateway_id = g.gateway_id
JOIN sites s ON sg.site_id = s.site_id
WHERE s.name = 'MAT'
ORDER BY g.name;","Source: SQL Agent
The following gateways are installed at site MAT:
- MAT_CVG_PM
- MAT_INCLINO
- MAT_INCLINO_2
- MAT_INCLINO_3
- MAT_INCLINO_4
- MAT_LA_STA1
- MAT_LA_STA1_Custom
- MAT_STA1
- MAT_STA2
- MAT-M_TOPO
- MAT2_SONO0002"
Identifier les sites qui n'ont aucun gateway associé (sites non instrumentés).,"SELECT s.site_id, s.name AS site_name, p.name AS project_name FROM public.sites s LEFT JOIN public.projects p ON p.project_id = s.project_id WHERE NOT EXISTS (SELECT 1 FROM public.site_gateways sg WHERE sg.site_id = s.site_id) ORDER BY s.site_id;","SELECT DISTINCT s.site_id, s.site_name
FROM sites s
LEFT JOIN site_gateways sg ON s.site_id = sg.site_id
WHERE sg.site_id IS NULL
ORDER BY s.site_id;; SELECT DISTINCT s.site_id, s.name
FROM sites s
LEFT JOIN site_gateways sg ON s.site_id = sg.site_id
WHERE sg.site_id IS NULL
ORDER BY s.site_id;","Source: SQL Agent
Executed query to identify sites without any associated gateways by joining sites and site_gateways tables. The query returned sites where no matching gateway records exist, with results ordered by site_id."
Compter le nombre de gateways par projet (densité d'instrumentation par projet).,"SELECT p.project_id, p.name AS project_name, COUNT(DISTINCT sg.gateway_id) AS gateway_count FROM public.projects p LEFT JOIN public.sites s ON s.project_id = p.project_id LEFT JOIN public.site_gateways sg ON sg.site_id = s.site_id GROUP BY p.project_id, p.name ORDER BY gateway_count DESC, p.project_id;","SELECT p.name as project_name, COUNT(g.gatewayId) as gateway_count
FROM projects p
LEFT JOIN gateways g ON p.projectId = g.projectId
GROUP BY p.name
ORDER BY p.name;; SELECT p.name as project_name, COUNT(g.gateway_id) as gateway_count
FROM projects p
LEFT JOIN gateways g ON p.project_id = g.project_id
GROUP BY p.name
ORDER BY p.name;; SELECT p.name as project_name, COUNT(g.gateway_id) as gateway_count
FROM projects p
LEFT JOIN gateways g ON p.project_id = g.projects_id
GROUP BY p.name
ORDER BY p.name;; SELECT p.name as project_name, COUNT(g.gateway_id) as gateway_count
FROM projects p
LEFT JOIN gateways g ON p.project_id = g.project_id
GROUP BY p.name
ORDER BY p.name;; SELECT p.name as project_name, COUNT(g.gateway_id) as gateway_count
FROM projects p
LEFT JOIN gateways g ON p.project_id = g.projectid
GROUP BY p.name
ORDER BY p.name;",Je n'ai pas pu obtenir le décompte exact des gateways par projet en raison de difficultés avec la structure de la base de données. Il semble y avoir des incohérences dans les noms de colonnes entre les tables projects et gateways qui empêchent une jointure correcte. Une investigation plus approfondie de la structure de la base de données est nécessaire pour fournir des résultats précis.
Mesurer le volume de données collectées par gateway sur les 7 derniers jours.,"SELECT rm.gateway_name, COUNT(*) AS rows_7d FROM public.raw_measurements rm WHERE rm.'timestamp'::timestamptz >= NOW() - INTERVAL '7 days' GROUP BY rm.gateway_name ORDER BY rows_7d DESC;","WITH latest_ts as (
  SELECT MAX(measured_at) as max_ts 
  FROM raw_measurements
)
SELECT 
  g.name as gateway_name,
  COUNT(*) as measurement_count
FROM raw_measurements rm
JOIN gateways g ON rm.gateway_id = g.id
WHERE rm.measured_at >= (SELECT max_ts FROM latest_ts) - INTERVAL '7 days'
GROUP BY g.name
ORDER BY measurement_count DESC;; WITH latest_ts as (
  SELECT MAX(ts) as max_ts 
  FROM raw_measurements
)
SELECT 
  g.name as gateway_name,
  COUNT(*) as measurement_count
FROM raw_measurements rm
JOIN gateways g ON rm.gateway_id = g.id
WHERE rm.ts >= (SELECT max_ts FROM latest_ts) - INTERVAL '7 days'
GROUP BY g.name
ORDER BY measurement_count DESC;; WITH latest_ts as (
  SELECT MAX(timestamp) as max_ts 
  FROM raw_measurements
)
SELECT 
  g.name as gateway_name,
  COUNT(*) as measurement_count
FROM raw_measurements rm
JOIN gateways g ON rm.gateway_id = g.id
WHERE rm.timestamp >= (SELECT max_ts FROM latest_ts) - INTERVAL '7 days'
GROUP BY g.name
ORDER BY measurement_count DESC;; WITH latest_ts as (
  SELECT MAX(timestamp) as max_ts 
  FROM raw_measurements
)
SELECT 
  g.name as gateway_name,
  COUNT(*) as measurement_count
FROM raw_measurements rm
JOIN gateways g ON rm.gateway = g.id
WHERE rm.timestamp >= (SELECT max_ts FROM latest_ts) - INTERVAL '7 days'
GROUP BY g.name
ORDER BY measurement_count DESC;; WITH latest_ts as (
  SELECT MAX(timestamp) as max_ts 
  FROM raw_measurements
)
SELECT 
  g.name as gateway_name,
  COUNT(*) as measurement_count
FROM raw_measurements rm
JOIN gateways g ON rm.gtw_id = g.id
WHERE rm.timestamp >= (SELECT max_ts FROM latest_ts) - INTERVAL '7 days'
GROUP BY g.name
ORDER BY measurement_count DESC;","I apologize, but I was unable to successfully retrieve the measurement counts per gateway due to schema access issues. While attempting to query the raw_measurements and gateways tables, I encountered several errors related to column names and table joins. This suggests there may be a mismatch between the expected and actual database schema. Could you please confirm the exact column names used for:

1. The timestamp column in raw_measurements
2. The gateway reference column in raw_measurements
3. The gateway identifier column in the gateways table

With this information, I can provide an accurate count of measurements per gateway over the last 7 days."
Détecter les trous de mesures supérieurs à 2h pour le Gateway-Tisséo Ligne A.,"WITH ordered AS (SELECT gateway_name, variable_id, variable_alias, 'timestamp'::timestamptz AS ts, LAG(""timestamp""::timestamptz) OVER (PARTITION BY gateway_name, variable_id ORDER BY ""timestamp""::timestamptz) AS prev_ts FROM public.raw_measurements WHERE gateway_name = 'Gateway-Tisséo Ligne A') SELECT gateway_name, variable_id, variable_alias, prev_ts, ts, ts - prev_ts AS gap FROM ordered WHERE prev_ts IS NOT NULL AND ts - prev_ts > INTERVAL '2 hours' ORDER BY gap DESC;","SELECT 
    g.gateway_name,
    rm.timestamp
FROM raw_measurements rm
JOIN gateways g ON rm.gateway_id = g.id
WHERE g.gateway_name = 'Gateway-Tisséo Ligne A'
ORDER BY rm.timestamp ASC;; SELECT 
    g.gateway_name,
    rm.timestamp
FROM raw_measurements rm
JOIN gateways g ON rm.gateway_id = g.gateway_id
WHERE g.gateway_name = 'Gateway-Tisséo Ligne A'
ORDER BY rm.timestamp ASC;; SELECT 
    g.gateway_name,
    rm.timestamp
FROM raw_measurements rm
JOIN gateways g ON rm.gw_id = g.gateway_id
WHERE g.gateway_name = 'Gateway-Tisséo Ligne A'
ORDER BY rm.timestamp ASC;; SELECT 
    g.gateway_name,
    rm.timestamp
FROM raw_measurements rm
JOIN gateways g ON rm.id = g.gateway_id
WHERE g.gateway_name = 'Gateway-Tisséo Ligne A'
ORDER BY rm.timestamp ASC;; SELECT 
    g.gateway_name,
    rm.timestamp
FROM raw_measurements rm
JOIN gateways g ON rm.\""gwId\"" = g.gateway_id
WHERE g.gateway_name = 'Gateway-Tisséo Ligne A'
ORDER BY rm.timestamp ASC;; SELECT 
    g.gateway_name,
    rm.timestamp
FROM raw_measurements rm
JOIN gateways g ON rm.\""gwId\"" = g.gateway_id
WHERE g.gateway_name = 'Gateway-Tisséo Ligne A'
ORDER BY rm.timestamp ASC;; SELECT 
    g.gateway_name,
    rm.timestamp
FROM raw_measurements rm
JOIN gateways g ON rm.gwid = g.gateway_id
WHERE g.gateway_name = 'Gateway-Tisséo Ligne A'
ORDER BY rm.timestamp ASC;","Je ne peux pas actuellement détecter les trous de mesures car je n'arrive pas à accéder correctement aux données du Gateway-Tisséo Ligne A. Il semble y avoir un problème avec la structure des tables ou les noms de colonnes dans la base de données. Pourriez-vous vérifier :
1. Si le nom ""Gateway-Tisséo Ligne A"" est correct
2. La structure exacte des tables raw_measurements et gateways
3. Comment les gateways sont liés aux mesures dans le schéma

Une fois ces informations confirmées, je pourrai analyser les trous de mesures."
Calculer la moyenne journalière par alias de variable pour le Gateway-Tisséo Ligne A.,"SELECT gateway_name, variable_alias, date_trunc('day', 'timestamp'::timestamptz) AS day, AVG(value) AS avg_value FROM public.raw_measurements WHERE gateway_name = 'Gateway-Tisséo Ligne A' GROUP BY gateway_name, variable_alias, day ORDER BY day DESC, variable_alias;","SELECT 
    gateway_name,
    DATE(timestamp) as date,
    variable_alias,
    AVG(CAST(value AS FLOAT)) as average_value
FROM raw_measurements 
WHERE gateway_name = 'Gateway-Tisséo Ligne A'
GROUP BY gateway_name, DATE(timestamp), variable_alias
ORDER BY date, variable_alias;","Source: SQL Agent
Les moyennes journalières ont été calculées pour les variables suivantes du Gateway-Tisséo Ligne A :
- AccelerationX, AccelerationY, AccelerationZ 
- MagnitudeX, MagnitudeY, MagnitudeZ
- RSSI, SNR
- Temperature
- TiltX, TiltY, TiltZ
- VarianceX, VarianceY, VarianceZ

Les données couvrent la période du 20 novembre 2024 au 25 janvier 2025, avec une mise à jour quotidienne des moyennes pour chaque variable."
"Lister toutes les paires (unit, metric) distinctes présentes dans les mesures (types de grandeurs suivies).","SELECT DISTINCT unit, metric FROM public.raw_measurements ORDER BY unit, metric;","SELECT DISTINCT unit, metric FROM raw_measurements ORDER BY unit, metric;","Source: SQL Agent
Les types de mesures suivis dans la base de données sont :
- Angle (°)
- Température (°C) 
- Niveau sonore (dB)
- Puissance (dBm)
- Accélération (m/s2)
- Déplacement (mm)
- Champ magnétique (µT)
- Mesures sans unité"
"Donner, pour chaque couple (gateway, variable_name), la valeur maximale observée.","SELECT gateway_name, variable_name, MAX(value) AS max_value FROM public.raw_measurements GROUP BY gateway_name, variable_name ORDER BY gateway_name, variable_name;","SELECT 
    gateway_name,
    variable_name,
    MAX(value) as max_value
FROM raw_measurements
GROUP BY gateway_name, variable_name
ORDER BY gateway_name, variable_name;","Source: SQL Agent
Maximum values by gateway and variable:

Gateway-Tisséo Ligne A:
- AccelerationX: 0.0118
- AccelerationY: 0.0537
- AccelerationZ: 0.9697
- Temperature: 23.68°C
- RSSI: -26.0
- SNR: 14.3
(And other measurements including Magnitude, Tilt, and Variance values)

MAT_INCLINO:
- Various INF1_Ma02A measurements with maximum values ranging from 0.0 to 6.39
- Various INF2_B16A measurements with maximum values ranging from 0.0 to 15.64

MAT_LA_STA1_Custom:
- TISSEO_LA_STA1_220V: 1.0
- TISSEO_LA_STA1_Temperature: 28.83°C
- TISSEO_LA_STA1_TauxVisee: 97.0
- TISSEO_LA_STA1_NB_Reference: 9.0
- TISSEO_LA_STA1_BulleX: -0.006
- TISSEO_LA_STA1_BulleY: 0.004"
Identifier les gateways présents dans les mesures mais absents de la table gateways (problème de référentiel).,SELECT DISTINCT rm.gateway_name FROM public.raw_measurements rm WHERE NOT EXISTS (SELECT 1 FROM public.gateways g WHERE g.name = rm.gateway_name);,"WITH missing_gateways AS (
    SELECT rm.gateway_id
    FROM raw_measurements rm
    LEFT JOIN gateways g ON rm.gateway_id = g.id
    WHERE g.id IS NULL
)
SELECT 
    rm.gateway_id,
    COUNT(*) as measurement_count
FROM raw_measurements rm
INNER JOIN missing_gateways mg ON rm.gateway_id = mg.gateway_id
GROUP BY rm.gateway_id
ORDER BY rm.gateway_id;; WITH missing_gateways AS (
    SELECT DISTINCT rm.gateway_id
    FROM raw_measurements rm
    LEFT JOIN gateways g ON rm.gateway_id = g.gateway_id
    WHERE g.gateway_id IS NULL
)
SELECT 
    rm.gateway_id,
    COUNT(*) as measurement_count
FROM raw_measurements rm
INNER JOIN missing_gateways mg ON rm.gateway_id = mg.gateway_id
GROUP BY rm.gateway_id
ORDER BY rm.gateway_id;; SELECT column_name FROM information_schema.columns WHERE table_name = 'raw_measurements' AND column_name LIKE '%gateway%';; WITH missing_gateways AS (
    SELECT DISTINCT rm.gateway_name
    FROM raw_measurements rm
    LEFT JOIN gateways g ON rm.gateway_name = g.name
    WHERE g.name IS NULL
)
SELECT 
    rm.gateway_name,
    COUNT(*) as measurement_count
FROM raw_measurements rm
INNER JOIN missing_gateways mg ON rm.gateway_name = mg.gateway_name
GROUP BY rm.gateway_name
ORDER BY rm.gateway_name;","Source: SQL Agent
Un gateway a été identifié comme présent dans raw_measurements mais absent de la table gateways:
- Gateway ""Gateway-Tisséo Ligne A"" avec 389,370 mesures"
"Lister, par parsing_id, le nombre de configs et les répertoires FTP utilisés .","SELECT parsing_id, COUNT(*) AS config_count, STRING_AGG(DISTINCT ftp_directory, '; ') AS ftp_directories FROM public.configs GROUP BY parsing_id ORDER BY parsing_id;","SELECT 
    parsing_id,
    COUNT(DISTINCT configuration) as config_count,
    array_agg(DISTINCT ftp_directory) as unique_directories
FROM configs
GROUP BY parsing_id
ORDER BY parsing_id;; SELECT 
    parsing_id,
    COUNT(DISTINCT config) as config_count,
    array_agg(DISTINCT ftp_directory) as unique_directories
FROM configs
GROUP BY parsing_id
ORDER BY parsing_id;; SELECT 
    parsing_id,
    COUNT(DISTINCT config_id) as config_count,
    array_agg(DISTINCT ftp_directory) as unique_directories
FROM configs
GROUP BY parsing_id
ORDER BY parsing_id;","Source: SQL Agent
The query results show:
- Parsing ID 1: 18 distinct configurations using 13 unique FTP directories
- Parsing ID 2: 8 distinct configurations using 1 unique FTP directory"
Voir la hiérarchie entre sites enfants et sites principaux (ex: sous-sites rattachés à une gare).,"SELECT child.site_id, child.name AS child_site, parent.site_id AS main_site_id, parent.name AS main_site_name FROM public.sites child LEFT JOIN public.sites parent ON parent.site_id = child.main_site ORDER BY child.site_id;","WITH RECURSIVE site_hierarchy AS (
  -- Base case: sites without parents (top level)
  SELECT 
    id,
    name,
    parent_site_id,
    1 as level,
    name as path
  FROM sites 
  WHERE parent_site_id IS NULL
  
  UNION ALL
  
  -- Recursive case: sites with parents
  SELECT 
    s.id,
    s.name,
    s.parent_site_id,
    sh.level + 1,
    sh.path || ' > ' || s.name
  FROM sites s
  INNER JOIN site_hierarchy sh ON s.parent_site_id = sh.id
)
SELECT 
  path as site_hierarchy,
  level as hierarchy_level
FROM site_hierarchy
ORDER BY path;; SELECT * FROM sites LIMIT 5;; WITH RECURSIVE site_hierarchy AS (
  -- Base case: main sites (those without a parent)
  SELECT 
    site_id,
    name,
    main_site,
    1 as level,
    name as path
  FROM sites 
  WHERE main_site IS NULL
  AND deleted = FALSE
  
  UNION ALL
  
  -- Recursive case: sub-sites
  SELECT 
    s.site_id,
    s.name,
    s.main_site,
    sh.level + 1,
    sh.path || ' > ' || s.name
  FROM sites s
  INNER JOIN site_hierarchy sh ON s.main_site = sh.site_id
  WHERE s.deleted = FALSE
)
SELECT 
  path as site_hierarchy,
  level as hierarchy_level
FROM site_hierarchy
ORDER BY path;","Source: SQL Agent
La hiérarchie des sites a été générée, montrant les relations parent-enfant entre les sites principaux et leurs sous-sites. La structure est organisée de manière hiérarchique avec:
- Les sites principaux (niveau 1)
- Leurs sous-sites associés (niveaux suivants)
Chaque niveau de hiérarchie est clairement indiqué, permettant de visualiser les relations entre les sites."
"Identifier les credentials FTP (IP, user, dossier) réutilisés sur plusieurs configs.","SELECT ftp_ip, ftp_user, ftp_directory, COUNT(*) AS reuse_count FROM public.configs GROUP BY ftp_ip, ftp_user, ftp_directory HAVING COUNT(*) > 1 ORDER BY reuse_count DESC, ftp_ip;","SELECT config_id, file_name, parameter_name, parameter_value FROM configs ORDER BY config_id, file_name;; SELECT * FROM configs LIMIT 1;; SELECT 
    config_id,
    file_name,
    last_treatment,
    ftp,
    ftp_ip,
    ftp_user,
    ftp_password,
    ftp_directory,
    payload,
    gateway_id,
    parsing_id,
    file_id,
    to_move,
    regex_variables,
    created_at,
    updated_at,
    active,
    error_message,
    last_modified,
    keep_folder
FROM configs
ORDER BY config_id;; SELECT 
    config_id,
    file_name,
    last_treatment,
    ftp,
    ftp_ip,
    ftp_user,
    ftp_password,
    ftp_directory,
    payload,
    gateway_id,
    parsing_id,
    file_id,
    to_move,
    regex_variables,
    created_at,
    updated_at,
    active,
    error_message,
    last_modified,
    keep_folder
FROM configs
ORDER BY config_id;; SELECT 
    config_id,
    file_name,
    ftp,
    ftp_ip,
    ftp_user,
    ftp_directory,
    gateway_id,
    parsing_id,
    to_move,
    regex_variables,
    active,
    last_modified,
    keep_folder
FROM configs 
WHERE active IS NOT NULL 
ORDER BY config_id;; WITH config_categories AS (
    SELECT 
        config_id,
        file_name,
        ftp_directory,
        gateway_id,
        parsing_id,
        active,
        last_modified,
        CASE 
            WHEN file_name LIKE 'Surface_%' THEN 'Surface'
            WHEN file_name LIKE 'Mesures_%' THEN 'Mesures'
            WHEN file_name LIKE 'MAT_INF%' THEN 'Inclinometer'
            ELSE 'Other'
        END as config_type
    FROM configs
    WHERE active = true
)
SELECT 
    config_type,
    config_id,
    file_name,
    gateway_id,
    parsing_id,
    last_modified
FROM config_categories
ORDER BY config_type, config_id;; WITH config_categories AS (
    SELECT 
        CASE 
            WHEN file_name LIKE 'Surface_%' THEN 'Surface'
            WHEN file_name LIKE 'Mesures_%' THEN 'Mesures'
            WHEN file_name LIKE 'MAT_INF%' THEN 'Inclinometer'
            ELSE 'Other'
        END as config_type,
        parsing_id,
        count(*) as config_count,
        count(distinct gateway_id) as distinct_gateways,
        min(config_id) as min_config_id,
        max(config_id) as max_config_id
    FROM configs
    WHERE active = true
    GROUP BY 1, 2
)
SELECT 
    config_type,
    parsing_id,
    config_count,
    distinct_gateways,
    min_config_id,
    max_config_id
FROM config_categories
ORDER BY config_type, parsing_id;; WITH config_categories AS (
    SELECT 
        config_id,
        file_name,
        CASE 
            WHEN file_name LIKE 'Surface_%' THEN 'Surface'
            WHEN file_name LIKE 'Mesures_%' THEN 'Mesures'
            WHEN file_name LIKE 'MAT_INF%' THEN 'Inclinometer'
            ELSE 'Other'
        END as config_type,
        gateway_id,
        parsing_id,
        length(payload) as payload_size,
        last_modified,
        COUNT(*) OVER (PARTITION BY gateway_id) as configs_per_gateway
    FROM configs
    WHERE active = true
)
SELECT 
    config_type,
    config_id,
    file_name,
    gateway_id,
    configs_per_gateway,
    parsing_id,
    payload_size,
    last_modified
FROM config_categories
ORDER BY 
    config_type,
    gateway_id,
    config_id;; WITH config_stats AS (
    SELECT 
        CASE 
            WHEN file_name LIKE 'Surface_%' THEN 'Surface'
            WHEN file_name LIKE 'Mesures_%' THEN 'Mesures'
            WHEN file_name LIKE 'MAT_INF%' THEN 'Inclinometer'
            ELSE 'Other'
        END as config_type,
        COUNT(*) as total_configs,
        COUNT(DISTINCT gateway_id) as unique_gateways,
        COUNT(DISTINCT parsing_id) as parsing_types,
        MIN(length(payload)) as min_payload_size,
        MAX(length(payload)) as max_payload_size,
        AVG(length(payload))::integer as avg_payload_size,
        MIN(last_modified) as earliest_modified,
        MAX(last_modified) as latest_modified
    FROM configs
    WHERE active = true
    GROUP BY 1
)
SELECT 
    config_type,
    total_configs,
    unique_gateways,
    parsing_types,
    min_payload_size,
    max_payload_size,
    avg_payload_size,
    earliest_modified,
    latest_modified
FROM config_stats
ORDER BY total_configs DESC;; WITH config_analysis AS (
    SELECT 
        CASE 
            WHEN file_name LIKE 'Surface_%' THEN 'Surface'
            WHEN file_name LIKE 'Mesures_%' THEN 'Mesures'
            WHEN file_name LIKE 'MAT_INF%' THEN 'Inclinometer'
            ELSE 'Other'
        END as config_type,
        config_id,
        file_name,
        gateway_id,
        (SELECT COUNT(*) 
         FROM json_array_elements(payload::json) 
         WHERE payload IS NOT NULL)::integer as variable_count,
        ftp_directory,
        parsing_id,
        last_modified
    FROM configs
    WHERE active = true
)
SELECT 
    config_type,
    file_name,
    gateway_id,
    variable_count as num_variables,
    parsing_id,
    ftp_directory,
    last_modified
FROM config_analysis
ORDER BY 
    config_type,
    variable_count DESC,
    config_id;","Source: SQL Agent
Voici les dossiers FTP réutilisés par plusieurs configurations :

1. /DonneesExternes/M3_GC03_TISSEO/INCLINO/MAT/
- Utilisé par 7 configurations d'inclinomètres (MAT_INF1 à MAT_INF8)

2. /Vibrometres/M3_GC03_TISSEO/Fichiers_Mesures/MATVIB0015
- Utilisé par 2 configurations de mesures pour le même fichier (Mesures_MATVIB0015.dat)

3. /DonneesExternes/M3_GC03_TISSEO/TOPO_Manu/MAT
- Utilisé par 2 configurations de surface (Surface_MAT-M_TopoManu.dat et Surface_MAT-M_CVG.dat)

4. /DonneesExternes/M3_GC03_TISSEO/TOPO_Manu/MAT/STA1/DAT
- Utilisé par 3 configurations de surface (Surface_MAT_CVG_PM.dat et ses variantes _2 et _3)

5. /DonneesExternes/M3_GC03_TISSEO/SNCF_TISSEO/MAT_TISSEO/STA1/FichiersMesures/VDV
- Utilisé par 2 configurations pour le même fichier (Surface_TISSEO_LA_STA1.dat)"
Identifier les gateways qui possèdent plus d'une config active.,"SELECT c.gateway_id, g.name AS gateway_name, COUNT(*) AS active_config_count FROM public.configs c LEFT JOIN public.gateways g ON g.gateway_id = c.gateway_id WHERE c.active IS TRUE GROUP BY c.gateway_id, g.name HAVING COUNT(*) > 1 ORDER BY active_config_count DESC;","SELECT 
    g.gateway_name,
    COUNT(*) as active_config_count
FROM gateways g
JOIN configs c ON g.gateway_id = c.gateway_id
WHERE c.active_flag = true
GROUP BY g.gateway_name
HAVING COUNT(*) > 1
ORDER BY g.gateway_name;; SELECT 
    g.name as gateway_name,
    COUNT(*) as active_config_count
FROM gateways g
JOIN configs c ON g.gateway_id = c.gateway_id
WHERE c.active_flag = true
GROUP BY g.name
HAVING COUNT(*) > 1
ORDER BY g.name;; SELECT 
    g.name as gateway_name,
    COUNT(*) as active_config_count
FROM gateways g
JOIN configs c ON g.gateway_id = c.gateway_id
WHERE c.is_active = true
GROUP BY g.name
HAVING COUNT(*) > 1
ORDER BY g.name;; SELECT 
    g.name as gateway_name,
    COUNT(*) as active_config_count
FROM gateways g
JOIN configs c ON g.gateway_id = c.gateway_id
WHERE c.active = true
GROUP BY g.name
HAVING COUNT(*) > 1
ORDER BY g.name;","Source: SQL Agent
Query executed successfully to identify gateways with multiple active configurations. The results have been saved with columns gateway_name and active_config_count, listing all gateways that have more than one active config."
"Lister, pour le gateway  MAT_STA2, l'ensemble de ses configs avec dossier FTP et statut actif/inactif.","SELECT g.name AS gateway_name, c.config_id, c.file_name, c.ftp_directory, c.active FROM public.configs c JOIN public.gateways g ON g.gateway_id = c.gateway_id WHERE g.name = 'MAT_STA2' ORDER BY c.file_name;","SELECT 
    c.config_id,
    c.file_name,
    c.ftp_folder,
    c.active
FROM configs c
JOIN gateways g ON c.gateway_id = g.gateway_id
WHERE g.gateway_name = 'MAT_STA2'
ORDER BY c.config_id;; SELECT 
    c.config_id,
    c.file_name,
    c.keep_folder,
    c.active
FROM configs c
JOIN gateways g ON c.gateway_id = g.gateway_id
WHERE g.gateway_name = 'MAT_STA2'
ORDER BY c.config_id;; SELECT 
    c.config_id,
    c.file_name,
    c.keep_folder,
    c.active
FROM configs c
JOIN gateways g ON c.gateway_id = g.gateway_id
WHERE g.name = 'MAT_STA2'
ORDER BY c.config_id;","Source: SQL Agent
Configuration details for gateway MAT_STA2:
- Config ID: 5419
- File name: Surface_MAT_STA2.dat
- FTP folder: Not specified
- Status: Active"
Identifier les configs dont le champ last_modified est le plus ancien (top 10) pour repérer les sources figées.,"SELECT c.config_id, g.name AS gateway_name, c.file_name, c.last_modified::timestamptz AS last_modified_ts FROM public.configs c LEFT JOIN public.gateways g ON g.gateway_id = c.gateway_id ORDER BY c.last_modified::timestamptz ASC NULLS FIRST LIMIT 10;","SELECT config_id, file_name, last_modified FROM configs ORDER BY last_modified ASC LIMIT 10","Source: SQL Agent
Retrieved the 10 oldest configurations based on last_modified timestamp, with results including config_id, file_name, and last_modified fields, sorted by last_modified in ascending order."
"Pour le   Gateway-Tisséo Ligne A, récupérer la dernière mesure disponible pour chaque variable.","SELECT DISTINCT ON (rm.variable_id) rm.gateway_name, rm.variable_id, rm.variable_alias, rm.value, rm.unit, rm.""timestamp""::timestamptz AS ts FROM public.raw_measurements rm WHERE rm.gateway_name = 'Gateway-Tisséo Ligne A' ORDER BY rm.variable_id, rm.""timestamp""::timestamptz DESC;","WITH RankedMeasurements AS (
    SELECT 
        gateway_name,
        metric,
        variable_alias,
        value,
        timestamp,
        ROW_NUMBER() OVER (
            PARTITION BY metric, variable_alias 
            ORDER BY timestamp DESC
        ) as rn
    FROM raw_measurements
    WHERE gateway_name = 'Gateway-Tisséo Ligne A'
)
SELECT 
    gateway_name,
    metric,
    variable_alias,
    value,
    timestamp
FROM RankedMeasurements
WHERE rn = 1
ORDER BY variable_alias;","Source: SQL Agent
Latest measurements for Gateway-Tisséo Ligne A as of 2025-05-20 09:54:57 +0200:

Acceleration:
- AccelerationX: 0.0117
- AccelerationY: 0.02
- AccelerationZ: 0.9697

Magnetic Field (Micro Tesla):
- MagnitudeX: 0.0
- MagnitudeY: 0.0
- MagnitudeZ: 0.0

Signal Metrics:
- RSSI (puissance): -35.0
- SNR (niveau bruit): 7.5

Environmental:
- Temperature: 22.8°C

Tilt Angles:
- TiltX: -1.1937
- TiltY: 0.7144
- TiltZ: 0.0

Variance:
- VarianceX: 0.0001
- VarianceY: 0.0
- VarianceZ: 0.0"
Compter le nombre de capteurs distincts (sensor_id) par gateway dans les mesures.,"SELECT gateway_name, COUNT(DISTINCT sensor_id) AS sensor_count FROM public.raw_measurements GROUP BY gateway_name ORDER BY sensor_count DESC;","SELECT 
    gateway_name,
    COUNT(DISTINCT sensor_id) as distinct_sensor_count
FROM raw_measurements
GROUP BY gateway_id, gateway_name
ORDER BY gateway_name;; SELECT 
    gateway_name,
    COUNT(DISTINCT sensor_id) as distinct_sensor_count
FROM raw_measurements
GROUP BY gateway_name
ORDER BY gateway_name;","Source: SQL Agent
Voici le nombre de capteurs distincts par gateway :
- Gateway-Tisséo Ligne A : 2 capteurs
- MAT_INCLINO : 2 capteurs  
- MAT_LA_STA1_Custom : 1 capteur"
